<!DOCTYPE html>
<html>
<head>
  <title></title>
</head>
<body style="background-color: darkslategray;">
  <script src="../../src/avm2/util.js"></script>
  <script src="../../src/flash/util.js"></script>
  <script src="../../src/swf/util.js"></script>
  <script src="../inspector/js/classes/FPS.js"></script>

  <div>
    <canvas id="stageCanvas" width="1024" height="1024"></canvas>
  </div>
  <script>
    var canvas = document.getElementById("stageCanvas");
    var context = canvas.getContext("2d");
    context.font = 14 + 'px Consolas, "Liberation Mono", Courier, monospace';

    context.fillRect(0, 0, canvas.width, canvas.height);

    var stream = [{"w":32,"h":32},{"w":32,"h":32},{"w":32,"h":32},{"w":46,"h":22},{"w":46,"h":23},{"w":46,"h":21},{"w":46,"h":22},{"w":46,"h":20},{"w":755,"h":109},{"w":300,"h":454},{"w":396,"h":336},{"w":69,"h":67},{"w":69,"h":67},{"w":71,"h":58},{"w":71,"h":58},{"w":71,"h":58},{"w":71,"h":58},{"w":71,"h":58},{"w":69,"h":70},{"w":71,"h":58},{"w":71,"h":58},{"w":71,"h":58},{"w":71,"h":58},{"w":71,"h":58},{"w":71,"h":58},{"w":71,"h":58},{"w":71,"h":58},{"w":71,"h":58},{"w":71,"h":58},{"w":71,"h":58},{"w":71,"h":58},{"w":71,"h":58},{"w":71,"h":58},{"w":71,"h":58},{"w":71,"h":58},{"w":71,"h":58},{"w":71,"h":58},{"w":71,"h":58},{"w":71,"h":58},{"w":71,"h":58},{"w":71,"h":58},{"w":71,"h":58},{"w":71,"h":58},{"w":65,"h":71}];

    var LOTS = false;
    if (LOTS) {
      var stream = [];
      for (var j = 0; j < 7; j ++) {
        for (var i = 0; i < 100 * j; i++) {
          var size = 1 << (2 + 6 - j);
          stream.push({w: (Math.random() * size) | 0, h: (Math.random() * size) | 0});
        }
      }
    }

    var SORT = false;
    if (SORT) {
      stream.sort(function (a, b) {
        return b.w - a.w;
      });

      stream.sort(function (a, b) {
        return b.h - a.h;
      });
    }

    var packer = new Packer(1024, 1024);
    var total = stream.length;
    setInterval(function add() {
      var item = stream.shift();
      if (!item) {
        console.info("Done " + total);
        return;
      }
      var position = packer.insert(item.w, item.h);
      if (!position) {
        console.info("Can't insert: " + item.x);
        return;
      }
      context.fillStyle = randomStyle();
      context.fillRect(position.x, position.y, item.w, item.h);
    }, 10);

  </script>
</body>
</html>